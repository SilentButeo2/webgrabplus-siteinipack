**------------------------------------------------------------------------------------------------
* @header_start
* WebGrab+Plus ini for grabbing EPG data from TvGuide websites
* @Site: meo.pt
* @MinSWversion: V5.5
* @Revision 10 - [18/12/2025] Blackbear199
* @Revision 9 - [16/02/2024] Blackbear199
*   showicon fix
* @Revision 8 - [07/01/2024] Blackbear199
*   showsplit scope fix
*   add show delay
* @Revision 7 - [14/03/2023] Blackbear199
*   url change
* @Revision 6 - [26/03/2019] Mat8861 
* @Revision 5 - [03/05/2017] Blackbear199
*   site changes(new epg page)
* @Revision 4 - [20/10/2014] Jan van Straaten
*   small improvements (headers, timezone)
* @Revision 3 - [08/05/2014] Jan van Straaten
*   adapted to site changes
* @Revision 2 - [26/04/2011] Willy De Wilde/Jan van Straaten
*   none
* @Remarks: use local timezone for timezone= setting
*
* @header_end
**------------------------------------------------------------------------------------------------
site {url=meo.pt|timezone=Europe/Lisbon|maxdays=7|cultureinfo=pt-PT|charset=utf-8|titlematchfactor=60}
site {ratingsystem=PT|episodesystem=onscreen}
*
scope.range {(urlindex)|end}
url_index.headers {method=POST_BACK(GET,GET)}
url_index         {url|https://meogouser.apps.meo.pt/Services/Authentication/User.svc/IsOauthAuthenticated}
url_index.headers {authority=meogouser.apps.meo.pt}
url_index.headers {customheader=origin=https://www.meo.pt}
url_index.headers {referer=https://www.meo.pt}
url_index.headers {customheader=Accept-Encoding=gzip, deflate, br, zstd}
url_index.headers {customheader=accept-language=en,en-US;q=0.9,it-IT;q=0.8,it;q=0.7}
url_index.headers {accept=*/*}
end_scope
*
scope.range {(postback)|end}
url_index.modify                {set|https://meogouser.apps.meo.pt/Services/GridTv/GridTv.svc/GetLiveChannelProgramsByDate?callLetter='channel'&date='urldate'&userAgent=IPTV_OFR_GTV}
end_scope
*
urldate.format             {datestring|yyyy-MM-dd}
*
index_urlchannellogo.modify       {set|https://cdn-er-images.online.meo.pt/api/Channels/logos/image?callLetter='channel'&profile=corner_transparent_positive&width=60}
*
index_showsplit.scrub      {multi|"Result":[||]}|]}}
scope.range                {(splitindex)|end}
index_showsplit.modify     {replace|\},\{|\|}
index_showsplit.modify     {cleanup(style=unidecode)}
index_showsplit.modify     {cleanup(style=jsondecode)}
index_temp_5.modify        {substring(type=regex)|'index_showsplit' "\"StartDate\":\"(.+?)\","} 
index_temp_5.modify        {cleanup(removeduplicates link="index_showsplit")}
**index_showsplit.modify     {(debug)}
end_scope
*
scope.range                {(indexshowdetails)|end}
index_start.scrub          {single|"StartDate":"||",|",}
index_stop.scrub           {single|"EndDate":"||",|",}
index_title.scrub          {single|"Title":"||",|",}
index_description.scrub    {single|"Synopsis":"||","|","}	
index_episode.modify       {substring(pattern="T'S1' - Ep. 'E1'""T'S1' ""- Ep. 'E1'" type=regex)|'index_title' "((?:T\d+\s)?-\sEp\.\s\d+)?"}
index_title.modify         {remove(type=regex)|"(?:\sT\d+)?(?:-\sEp.\s\d+)?"}
index_temp_1.scrub         {single|"ProgramId":||,"|,"}
*
index_urlshow.modify       {addstart('index_temp_1' not "")|https://meogouser.apps.meo.pt/Services/GridTv/GridTv.svc/GetProgramInfoByProgramId?programId='index_temp_1'&userAgent=IPTV_OFR_GTV}
index_urlshow.headers 	   {authority=meogouser.apps.meo.pt}
index_urlshow.headers      {customheader=origin=https://www.meo.pt}
index_urlshow.headers      {referer=https://www.meo.pt}
index_urlshow.headers      {customheader=Accept-Encoding=gzip, deflate, br, zstd}
index_urlshow.headers      {customheader=accept-language=en,en-US;q=0.9,it-IT;q=0.8,it;q=0.7}
end_scope
*
title.scrub                {single|"TitleId":"||"|}}
description.scrub          {single|"Synopsis":"||",|",}
showicon.scrub             {single|"Title":"||",|",}
*
title.modify               {cleanup(style=jsondecode)}
title.modify               {remove(type=regex)|"(?:\sT\d+)?(?:-\sEp.\s\d+)?"}
description.modify         {cleanup(style=jsondecode)}
rating.modify              {substring(type=regex)|'description' "\sClassificação\setária:\s([AMP]\/\d+)\."}
description.modify         {remove(type=regex)|"\sClassificação\setária:\s[AMP]\/\d+\."}
showicon.modify            {cleanup(style=urlencode)}
showicon.modify            {set(not "")|https://cdn-er-images.online.meo.pt/eemstb/ImageHandler.ashx?progTitle='showicon'&chCallLetter='config_site_id'&profile=16_9&appSource=GuiaTV&width=300&stb=retina2x}
actor.scrub                {single(separator="," max=3)|"Participants":"||",|",}
**  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _
**      #####  CHANNEL FILE CREATION (only to create the xxx-channel.xml file)
**
** @auto_xml_channel_start
*scope.range {(urlindex)|end}
*url_index.headers {method=POST_BACK(GET,GET)}
*url_index                {url|https://meogouser.apps.meo.pt/Services/Authentication/User.svc/IsOauthAuthenticated}
*url_index.headers {customheader=authority=meogouser.apps.meo.pt}
*url_index.headers {origin=https://www.meo.pt}
*url_index.headers {referer=https://www.meo.pt}
*end_scope
*
*scope.range {(postback)|end}
*url_index.modify                {set|https://meogouser.apps.meo.pt/Services/GridTv/GridTv.svc/GetContentsForChannels?userAgent=IPTV_OFR_GTV}
*end_scope
*index_site_id.scrub      {regex||"CallLetter":"([^"]*)","ChannelPosition":\d+,"FriendlyUrlName":"[^"]*","||}
*index_site_channel.scrub {regex||"CallLetter":"[^"]*","ChannelPosition":\d+,".*?"Title":"([^"]*)"\}||}
*index_site_channel.modify{cleanup(style=jsondecode)}
*index_site_id.modify     {cleanup(removeduplicates link="index_site_channel")}
** @auto_xml_channel_end
