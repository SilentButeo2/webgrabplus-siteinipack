**------------------------------------------------------------------------------------------------
* @header_start
* WebGrab+Plus ini for grabbing IMDB data from TvGuide websites
* @MinSWversion: V5.5
*	-  (postprocess V3.4.2)
* @Site: imdb.com, primary search with imdb
* @Revision 21 [25/11/2025] Blackbear199
*	- update
* @Revision 20 [08/01/2025] Blackbear199
*	- site changes
* @Revision 19 [11/10/2023] Blackbear199
*	- actor fix for multiple roles
*   - other improvements
* @Revision 18 [20/09/2023] Blackbear199
*	- element fixes
* @Revision 17 [25/01/2023] Blackbear199
*	- better solution for tv series/tv mini series matching
* @Revision 16 [24/01/2023] Blackbear199
*	- element fixes,showicon appears to be no longer available?
*   - add mini tv series support
* @Revision 15 [03/01/2023] Jan van Straaten
*	- new element episodeabsolute
*	- fix of the conditions for how the index (temp_1) of episodenumlist , episodetitlelist and episode_id list (temp_6)
*	- correct way how this index is used to get the elelemnts out of these lists
*	- added producers from p7
* @Remarks: Series data extraction.
* @header_end
**------------------------------------------------------------------------------------------------
site {url=imdb.com|mdbinitype=serie|cultureinfo=en-GB|charset=UTF-8|matchfactor=70|searchsite=imdb}
site {episodesystem=onscreen}
*
scope.range {(primarysearch)|end}
url_primarysearch {url(urlencode=1)|https://www.imdb.com/find/?q=|'title'|}
url_primarysearch.headers {customheader=Accept-Encoding=gzip,deflate,br}
*
mdb_show_id.scrub {regex|primary||<div class="ipc-title ipc-title--base ipc-title--title ipc-title--title--reduced[^"]*cli-title[^"]*"><a href="/title/tt(\d+)/\?ref_=[^"]*"||}
mdb_show_id.modify {cleanup(removeduplicates)}
mdb_show_id.modify {substring(type=element)|0 5}
*
url_mdb_p1 {url|primary|https://www.imdb.com/title/tt|mdb_show_id|/}
url_mdb_p2 {url|primary|https://www.imdb.com/title/tt|mdb_show_id|/releaseinfo/}
url_mdb_p3 {url|primary|https://www.imdb.com/title/tt|mdb_show_id|/episodes/?season=|subpage|}
url_mdb_p4 {url|primary|https://www.imdb.com/title/tt|mdb_episode_id|/} 
url_mdb_p5 {url|primary|https://www.imdb.com/title/tt|mdb_episode_id|/fullcredits/}
url_mdb_p6 {url|primary|https://www.imdb.com/title/tt|mdb_show_id|/reviews/}
url_mdb_p7 {url|primary|https://www.imdb.com/title/tt|mdb_show_id|/episodes/}
url_mdb_p8 {url|primary|https://www.imdb.com/title/tt|mdb_episode_id|/plotsummary/}
url_mdb.headers {customheader=Accept-Encoding=gzip,deflate,br}
*
mdb_temp_9.scrub {regex|p7||data-testid="tab-season-entry"[^>]*>(\d+)</a>[^<]*<li role="presentation" data-currenttab="1"||}
subpage_mdb_p3.format {list(count='mdb_temp_9')|1}
end_scope
*
scope.range {(match)|end}
mdb_episodetitlelist.scrub {regex|p3||>S\d+\.E\d+ ∙ ([^<]*)<||}
mdb_episodenumlist.scrub {regex(pattern="S'S1'.E'E1'")|p3||>(S\d+\.E\d+) ∙ [^<]*<||}
* aka titles(limited to first 6,rest are loaded by javascript)
mdb_temp_1.scrub {regex|p2||<li role="presentation" class="ipc-metadata-list__item ipc-metadata-list__item--align-end" id="rel_aka_\d+".*?</div>[^<]*</li>||}
loop {(each "mdb_temp_9" in 'mdb_temp_1')|end}
mdb_temp_8.modify {substring(type=regex)|'mdb_temp_9' "<span class=\"ipc-metadata-list-item__list-content-item ipc-btn--not-interactable\"[^>]*>(.*?)<\/span>"}
mdb_temp_7.modify {substring(type=regex)|'mdb_temp_9' "<span class=\"ipc-metadata-list-item__label ipc-btn--not-interactable\"[^>]*>(.*?)<\/span>"}
mdb_temp_6.modify {substring(type=regex)|'mdb_temp_9' "<span class=\"ipc-metadata-list-item__list-content-item--subText\">(.*?)<\/span>"}
mdb_temp_7.modify {remove|(original title)}
mdb_temp_7.modify {remove(type=regex)|"^\(\|\)*"}
mdb_temp_6.modify {remove(type=regex)|"^\(\|\)*"}
mdb_temp_8.modify {addend('mdb_temp_7' not "")| ('mdb_temp_7')}
mdb_temp_8.modify {addend('mdb_temp_6' not "")|('mdb_temp_6')}
mdb_temp_5.modify {addend('mdb_temp_8' not "")|'mdb_temp_8'####}
end_loop
mdb_title.modify {substring('mdb_temp_5' not "" type=regex)|'mdb_temp_5' "(.*?)####"}
mdb_title.modify {cleanup(removeduplicates)}
* main title
mdb_title.scrub {single(includeblock="pageTitle")|p1|<h1|"hero__primary-text">|</span>|</h1>}
*
mdb_temp_2.scrub {regex|p3||<h4 data-testid(?:.*?)(?:<a href="/title/tt(\d+)/\?ref[^"]*"(?:.*?))*</h4>||}
end_scope
*
scope.range {(getelements)|end}
mdb_temp_3.modify {clear}
mdb_temp_3.modify {calculate(['mdb_episodetitlelist' not ""] ['mdb_subtitle' not ""] & type=element format=F0)|'mdb_episodetitlelist' 'mdb_subtitle' @}
mdb_temp_3.modify {calculate(['mdb_episodenumlist' not ""] ['mdb_episode' not ""] & ['mdb_temp_3' "-1"] & type=element format=F0)|'mdb_episodenumlist' 'mdb_episode' @}
*
if {('mdb_temp_3' not "-1")|end}
mdb_episode_id.modify {substring(type=element)|'mdb_temp_2' 'mdb_temp_3' 1}
mdb_subtitle.modify {substring(type=element)|'mdb_episodetitlelist' 'mdb_temp_3' 1}
mdb_episode.modify {substring(type=element)|'mdb_episodenumlist' 'mdb_temp_3' 1}
mdb_episodeabsolute.modify {calculate(format=F0)|'mdb_temp_3' 1 +}
mdb_episodeabsolute.modify {addstart|E}
end_if
*
mdb_description.scrub {single|p4|"description":"||","|","}
*
mdb_category.scrub {multi|p1|<div class="ipc-chip-list__scroller">|<span class="ipc-chip__text">|</span>|</div>}
*
mdb_director.scrub {regex|p5||>Directors?</span>(?:.*?)(?:<a class="ipc-link ipc-link--base name-credits--title-text name-credits--title-text-small"[^>]*>(.*?)</a>(?:.*?))*</section>||}
mdb_producer.scrub {regex|p5||>Producers?</span>(?:.*?)(?:<a class="ipc-link ipc-link--base name-credits--title-text name-credits--title-text-small"[^>]*>(.*?)</a>(?:.*?))*</section>||}
*
mdb_actor.scrub {regex|p5||>Cast</span>(?:.*?)(?:<a class="ipc-link ipc-link--base name-credits--title-text name-credits--title-text-small"[^>]*>(.*?)</div>[^<]*</div>(?:.*?))*</section>||}
mdb_actor.modify {cleanup(tags="<span>""</span>")}
mdb_actor.modify {replace(type=regex)|"[\(\)]"|'}
mdb_actor.modify {replace(type=regex)|"^[^<]*(<\/a>)"|(role=}
mdb_actor.modify {cleanup(tags="<"">")}
mdb_actor.modify {addend|)}
mdb_actor.modify {remove|(role=)}
*
mdb_productiondate.scrub {single|p4|<title>||</title>|</title>} *episode productiondate,series productiondate uses p1
mdb_productiondate.modify {calculate(format=productiondate)}
*
mdb_starrating.scrub {single|p4|"aggregateRating":{|"ratingValue":|}|}}
mdb_starrating.modify {calculate(not "" format=F1)}
*
mdb_starratingvotes.scrub {single|p4|"aggregateRating":{|"ratingCount":|,|}}
*
mdb_showicon.scrub {single|p4|data-testid="hero-media__poster">|src="|"|</div>}
*
mdb_country.scrub {single|p1|href="/search/title/?country_of_origin=|">|<|<}
*
mdb_plot.scrub {multi|p8|<div data-testid="sub-section-summaries"|<div class="ipc-metadata-list-item__content-container">|</div></div></div>|</ul>}
mdb_plot.modify {cleanup(tags="<span""</span>")}
mdb_plot.modify {cleanup(tags="<"">")}
mdb_plot.modify {clear('mdb_description' ~ 'mdb_plot')}
*
mdb_commentsummary.scrub {multi|p6|"reviewSummary":"||","|","}
mdb_commentsummary.modify {cleanup(style=unidecode)}
mdb_commentsummary.modify {cleanup(style=jsondecode)}
mdb_commentsummary.modify {cleanup(style=htmldecodespecialchar)}
*
mdb_review.scrub {multi|p6|"reviewText":"||","|","}
mdb_review.modify {cleanup(style=unidecode)}
mdb_review.modify {cleanup(style=jsondecode)}
mdb_review.modify {cleanup(style=htmldecodespecialchar)}
mdb_review.modify {remove(type=regex)|"<.*?>"}
mdb_review.modify {replace|\\n| }
end_scope
