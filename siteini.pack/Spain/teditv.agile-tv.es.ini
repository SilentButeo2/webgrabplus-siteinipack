**------------------------------------------------------------------------------------------------
* @header_start
* WebGrab+Plus ini for grabbing EPG data from TvGuide websites
* @Site: teditv.agile-tv.es
* @MinSWversion: V5.5
* @Revision 1 - [25/09/2025] Blackbear199
*   - rewrite
* @Revision 0 - [24/01/2022] Mat8861
*   - creation
* @Remarks: formarly tedi.telecable.es
* @header_end
**------------------------------------------------------------------------------------------------
site {url=teditv.agile-tv.es|timezone=UTC|maxdays=7.1|cultureinfo=es-ES|charset=UTF-8|titlematchfactor=90|allowlastdayoverflow}
site {ratingsystem=ES|episodesystem=onscreen}
*
scope.range {(urlindex)|end}
url_index {url|https://api-teditv.agile-tv.es/api/v1/Web/es-es/contents/epg/schedules?start=##start##&end=##end##&liveChannels=##channel##}
url_index.headers {referer=https://teditv.agile-tv.es/}
url_index.headers {customheader=Origin=https://teditv.agile-tv.es}
url_index.headers {customheader=Accept-Encoding=gzip,deflate,br}
*
global_temp_9.modify {calculate(format=F0)|'config_timespan_days'}
global_temp_9.modify {set(> "7")|7}
*
global_temp_8.modify {calculate(format=date,unix)|'urldate_formatted' 'local_offset' -}
global_temp_7.modify {calculate(format=date,unix)|'global_temp_8' 'global_temp_9':23:59 +}
*
global_temp_1.modify {substring(type=regex)|'config_site_id' "^[^#]*"}
global_temp_2.modify {substring(type=regex)|'config_site_id' "[^#]*$"}
*
url_index.modify {replace|##channel##|'global_temp_1'}
url_index.modify {replace|##start##|'global_temp_8'}
url_index.modify {replace|##end##|'global_temp_7'}
*
urldate.format {datestring|yyyy/MM/dd}
end_scope
*
index_urlchannellogo.modify {set(scope=datelogo)|https://imageservice.agiletv.es/v1?width=100&format=WEBP&resize=RATIO&image=https%3A%2F%2Fagiletv-images.s3.eu-west-1.amazonaws.com%2F'global_temp_2'}
*
scope.range {(splitindex)|end}
index_showsplit.scrub {multi|"schedule":[||]}],"count"|]}],"count"}
index_showsplit.modify {replace(type=regex)|"\!\?\?\!"|-}
index_showsplit.modify {replace|\},\{"pid"|\}\|\{"pid"}
index_showsplit.modify {cleanup(style=unidecode)}
index_showsplit.modify {cleanup(style=jsondecode)}
*index_showsplit.modify {(debug)}
end_scope
*
scope.range {(indexshowdetails)|end}
index_start.scrub {single|"dateStart":||,|,}
index_stop.scrub {single|"dateEnd":||,|,}
index_title.scrub {single|"eventName":"||",|",}
index_description.scrub {single|"eventDescription":"||","|","}
category.scrub {single(separator="","")|"genres":["||"]|"]}
index_episode.scrub {single(pattern="T'S1' E'E1'""T'S1'""E'E1'")|"shortTitle":"||"|"}
index_rating.scrub {single|"advisoryRating":{|"title":"|"|}}
index_ratingicon.scrub {single|"advisoryRating":{|"iconUrl":"|"|}}
index_starrating.scrub {regex||"imdbRating":([1-9](?:\.\d+)?)||}
index_showicon.scrub {single|"images":{|"LandscapeCover":"|"|}}
index_temp_1.scrub {single|"pid":"||"|"}
*
index_title.modify {remove(type=regex)|"\s(?:T\d+\sE\d+\|-\sEpisodio\s\d+\|-\s\d+)"}
index_description.modify {remove('index_urlshow' not "")|'index_description'}
index_starrating.modify {addend(not "")|(system=Imdb)}
*
index_urlshow.modify {addstart|https://api-teditv.agile-tv.es/api/v1/Web/es-es/contents/'index_temp_1'/details}
index_urlshow.headers {referer=https://teditv.agile-tv.es/}
index_urlshow.headers {customheader=Origin=https://teditv.agile-tv.es}
index_urlshow.headers {customheader=Accept-Encoding=gzip,deflate,br}
end_scope
*
scope.range {(showdetails)|end}
category.scrub {single(separator="","")|"genres":["||"]|"]}
director.scrub {single(separator="","")|{"name":"Directors"|"list":["|"]|}}}
actor.scrub {single(separator="","")|{"name":"Actors"|"list":["|"]|}}}
productiondate.scrub {regex||"year":(\d{4})||}
*
title.modify {addstart|'index_title'}
end_scope
**  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _
**      #####  CHANNEL FILE CREATION (only to create the xxx-channel.xml file)
**
** @auto_xml_channel_start
*url_index {url(scope=urlindex)|https://api-teditv.agile-tv.es/api/v1/Web/es-es/contents/epg/live-channels?offset=0&limit=999}
*scope.range {(channellist)|end}
*index_site_id.scrub {regex||{"pid":"(.*?)"\}\]||}
*index_site_channel.scrub {multi|{"title":"||",|",}
*index_site_id.modify {cleanup(style=urlencode)}
*index_site_id.modify {replace(type=regex)|"^LCH\d+(.*\.com%2F)"|##}
*index_site_id.modify {cleanup(removeduiplicates link="index_site_channel")}
*end_scope
** @auto_xml_channel_end
